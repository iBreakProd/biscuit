services:
  redis:
    image: redis:alpine
    container_name: biscuit-redis
    restart: always
    ports:
      - "6379:6379"

  server:
    build:
      context: .
      dockerfile: apps/server/Dockerfile
    image: biscuit-server:latest
    container_name: biscuit-server
    restart: always
    depends_on:
      - redis
    ports:
      - "3001:3001"
    env_file: .env
    environment:
      - NODE_ENV=production
      # Override REDIS_URL from .env to point to the local service mesh
      - REDIS_URL=redis://redis:6379

  worker-drive-fetch:
    build:
      context: .
      dockerfile: apps/worker-drive-fetch/Dockerfile
    image: biscuit-worker-drive-fetch:latest
    container_name: biscuit-worker-drive-fetch
    restart: always
    depends_on:
      - redis
    env_file: .env
    environment:
      - NODE_ENV=production
      # Override REDIS_URL from .env to point to the local service mesh
      - REDIS_URL=redis://redis:6379

  worker-drive-vectorize:
    build:
      context: .
      dockerfile: apps/worker-drive-vectorize/Dockerfile
    image: biscuit-worker-drive-vectorize:latest
    container_name: biscuit-worker-drive-vectorize
    restart: always
    depends_on:
      - redis
    env_file: .env
    environment:
      - NODE_ENV=production
      # Override REDIS_URL from .env to point to the local service mesh
      - REDIS_URL=redis://redis:6379
